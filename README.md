<h1><center>ç¼–è¯‘åŸç†è¯¾ç¨‹å®éªŒ</center></h1>

## ä¸€ã€å®éªŒç›®çš„

ä»¥ç³»ç»Ÿèƒ½åŠ›æå‡ä¸ºç›®æ ‡ï¼Œé€šè¿‡å®éªŒé€æ­¥æ„å»ºä¸€ä¸ªå°†ç±»Cè¯­è¨€ç¿»è¯‘è‡³æ±‡ç¼–çš„ç¼–è¯‘å™¨ï¼Œæœ€ç»ˆç”Ÿæˆçš„æ±‡ç¼–ä»£ç é€šè¿‡GCCçš„æ±‡ç¼–å™¨è½¬åŒ–ä¸ºäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶åœ¨ç‰©ç†æœºæˆ–æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œã€‚å¸®åŠ©æŒæ¡ç¼–è¯‘åŸç†çš„å„ä¸ªç¯èŠ‚ï¼šè¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æã€ä»£ç ç”Ÿæˆï¼Œä»¥åŠå®ç°æ‰€éœ€çš„æ•°æ®ç»“æ„ï¼šè¯­æ³•æ ‘ã€ç¬¦å·è¡¨ç­‰ã€‚é€šè¿‡è¿™æ ·çš„å®éªŒï¼Œæé«˜å­¦ç”Ÿåä½œç¼–ç¨‹çš„èƒ½åŠ›ï¼ŒåŠ æ·±å¯¹ç¼–è¯‘æŠ€æœ¯çš„ç†è§£ï¼Œç¼–è¯‘åŸç†æ˜¯ä¸€é—¨ç»¼åˆå„ä¸ªå­¦ç§‘çŸ¥è¯†çš„è¯¾ç¨‹ï¼Œç¼–è¯‘ç³»ç»Ÿè®¾è®¡è®©å­¦ç”Ÿåœ¨å®è·µä¸­ç»¼åˆç†è§£è®¡ç®—æœºå­¦ç§‘çŸ¥è¯†ã€‚



## äºŒã€å®éªŒæ–¹æ¡ˆ

æœ¬æ¬¡å®éªŒå°†å®ç°ä¸€ä¸ªç”±SysY(ç²¾ç®€ç‰ˆCè¯­è¨€ï¼Œæ¥è‡ª[CSC / CSC-Compiler / Compiler2022 Â· GitLab (eduxiji.net)](https://gitlab.eduxiji.net/csc1/nscscc/compiler2022/-/tree/master))ç¿»è¯‘è‡³RISC-Væ±‡ç¼–çš„ç¼–è¯‘å™¨ï¼Œç”Ÿæˆçš„æ±‡ç¼–é€šè¿‡GCCçš„æ±‡ç¼–å™¨ç¿»è¯‘è‡³äºŒè¿›åˆ¶ï¼Œæœ€ç»ˆè¿è¡Œåœ¨æ¨¡æ‹Ÿå™¨qemu-riscvä¸Šå®éªŒè‡³å°‘åŒ…å«å››ä¸ªéƒ¨åˆ†:è¯æ³•å’Œè¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æå’Œä¸­é—´ä»£ç ç”Ÿæˆã€ä»¥åŠç›®æ ‡ä»£ç ç”Ÿæˆï¼Œæ¯ä¸ªéƒ¨åˆ†éƒ½ä¾èµ–å‰ä¸€ä¸ªéƒ¨åˆ†çš„ç»“æœï¼Œé€æ­¥æ„å»ºä¸€ä¸ªå®Œæ•´ç¼–è¯‘å™¨ã€‚

1. å®éªŒä¸€ï¼šè¯æ³•åˆ†æå’Œè¯­æ³•åˆ†æï¼Œå°†è¯»å–æºæ–‡ä»¶ä¸­ä»£ç å¹¶è¿›è¡Œåˆ†æï¼Œè¾“å‡ºä¸€é¢—è¯­æ³•æ ‘ã€‚
2. å®éªŒäºŒï¼šæ¥å—ä¸€é¢—è¯­æ³•æ ‘ï¼Œè¿›è¡Œè¯­ä¹‰åˆ†æã€ä¸­é—´ä»£ç ç”Ÿæˆï¼Œè¾“å‡ºä¸­é—´è¡¨ç¤ºIR(Intermediate Representation)
3. å®éªŒä¸‰ï¼šæ ¹æ®IRç¿»è¯‘æˆä¸ºæ±‡ç¼–
4. å®éªŒå››(å¯é€‰)ï¼šIRå’Œæ±‡ç¼–å±‚é¢çš„ä¼˜åŒ–



## ä¸‰ã€å®éªŒç¯å¢ƒæ­å»º

å®éªŒå¼€å§‹çš„ç¬¬ä¸€æ­¥ä¾¿æ˜¯æ­å»ºå®éªŒç¯å¢ƒï¼Œä¸€ä¸ªå¥½çš„å®éªŒç¯å¢ƒå¯ä»¥è®©ä½ äº‹åŠåŠŸå€ï¼Œä½†æ˜¯å¯æƒœçš„æ˜¯å®éªŒæŒ‡å¯¼ä¹¦æä¾›çš„å†…å®¹å¤§æ¦‚ç‡æ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œæ‰€ä»¥è¿˜éœ€è¦å¤§å®¶è‡ªè¡Œæ‘¸ç´¢ã€‚è¿™é‡Œæˆ‘ä»…å±•ç¤ºæˆ‘é…ç½®ç¯å¢ƒçš„è¿‡ç¨‹ï¼Œå¯¹äºä¸€äº›ç»†èŠ‚å’Œæ›´å¤šåŠŸèƒ½è¿˜éœ€è¦åŒå­¦ä»¬STFW(Search The Fucking Web)ã€‚

### 3.1 ä¸‹è½½å®éªŒæ¡†æ¶

[é‡åº†å¤§å­¦åœ¨å¸Œå†€å¹³å°ä¸Šçš„é¡¹ç›®](https://course.educg.net/indexcs/simple.jsp?loginErr=0)ä¸€å…±æä¾›äº†ä¸‰ä¸ªç‰ˆæœ¬çš„å®éªŒæ¡†æ¶ï¼Œè¿™é‡Œå»ºè®®ç›´æ¥ä¸‹è½½å®éªŒ3æˆ–è€…å®éªŒ4çš„ä»£ç æ¡†æ¶ï¼Œå®éªŒ1å’Œå®éªŒ2çš„æ¡†æ¶éƒ½åªåŒ…å«è‡ªå·±å®éªŒéœ€è¦çš„éƒ¨åˆ†ï¼Œä¸åŒ…æ‹¬åé¢çš„å†…å®¹ã€‚è¿™æ ·å¯ä»¥ä¸€ç›´å»¶ç»­ä½¿ç”¨ï¼Œä¸ç”¨ä¸­é€”æ›´æ¢ä»£ç ã€‚

>  [!warning]
>
> å®éªŒ2çš„ä»£ç æ¡†æ¶å­˜åœ¨é—®é¢˜ï¼Œå¦‚æœæ˜¯é€šè¿‡dockeré…ç½®çš„è¿è¡Œç¯å¢ƒï¼Œé‚£ä¹ˆä¼šå‡ºç°Cmakeç‰ˆæœ¬ä¸åŒ¹é…çš„é—®é¢˜ï¼Œè¿™é‡Œéœ€è¦ä¿®æ”¹CMakeLists.txtæ–‡ä»¶çš„ç¬¬ä¸€è¡Œä»£ç ä¸ºï¼š`cmake_minimum_required(VERSION 3.10)`ã€‚dockerç¯å¢ƒä¸­å’Œå…¶ä»–ä»£ç æ¡†æ¶æä¾›çš„ç‰ˆæœ¬éƒ½æ˜¯3.10ç‰ˆæœ¬ï¼Œè€Œå®éªŒ2ä»£ç æ¡†æ¶æ˜¯3.22ç‰ˆæœ¬ã€‚



### 3.2 å‡†å¤‡Linuxç¯å¢ƒ

è¿™é‡Œä¸å»ºè®®é…ç½®Windowså®éªŒç¯å¢ƒï¼Œå› ä¸ºåé¢çš„qemuåªèƒ½åœ¨Linuxç¯å¢ƒä¸‹è¿è¡Œã€‚æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥é…ç½®Linuxç¯å¢ƒï¼Œä¸€ç§æ˜¯é€šè¿‡VMwareè™šæ‹Ÿæœºï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡WSL(Windows Subsystem for Linux)ã€‚è¿™é‡Œå»ºè®®é€‰æ‹©åè€…ï¼ŒåŸå› æœ‰ä¸¤ç‚¹ï¼Œç¬¬ä¸€ä¸ªåŸå› æ˜¯æ€§èƒ½æ›´å¥½ï¼Œåœ¨ä»£ç é‡æ¯”è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½æ‰“å¼€Vscodeé˜…è¯»ä»£ç éƒ½ä¼šå‡ºç°å¡é¡¿ï¼Œä½¿ç”¨WSLå¯ä»¥æ˜¾è‘—æå‡æ€§èƒ½ï¼Œå› ä¸ºå®ƒæ˜¯ç›´æ¥è¿è¡Œåœ¨ç¡¬ä»¶ä¸Šã€‚ç¬¬äºŒä¸ªåŸå› æ˜¯å¯ä»¥æ›´æ–¹ä¾¿åœ°é€šè¿‡è¿œç¨‹è¿æ¥Vscodeï¼Œè¿™æ ·å°±å¯ä»¥æ›´åŠ æ–¹ä¾¿åœ°é…ç½®è°ƒè¯•ç¯å¢ƒã€‚

å…·ä½“çš„é…ç½®æ–¹æ³•è¿™é‡Œä¸åšå…·ä½“è®²è§£ï¼Œå› ä¸ºä½ å¤§æ¦‚ç‡ä¼šé‡åˆ°è‡ªå·±çš„é—®é¢˜ï¼Œæ‰€ä»¥è¿™é‡Œä»…ä»…ç»™å‡ºä¸€äº›æ­¥éª¤ï¼Œå…·ä½“çš„æ“ä½œè¿˜æ˜¯è¯·STFWã€‚

1. å¼€å¯Windowsç³»ç»Ÿçš„Linuxå­ç³»ç»ŸåŠŸèƒ½å’Œè™šæ‹Ÿæœºå¹³å°åŠŸèƒ½ã€‚
2. å®‰è£…WSLï¼Œå¯ä»¥å‡çº§åˆ°WSL2ï¼Œæ®è¯´æ€§èƒ½æ›´å¥½ã€‚
3. åœ¨WSLä¸­å®‰è£…Ubuntu22.04ç³»ç»Ÿã€‚



### 3.3 å‡†å¤‡dockerç¯å¢ƒ

å®Œæˆ3.2åä½ å·²ç»è·å¾—äº†è‡ªå·±çš„Linuxç³»ç»Ÿï¼Œä¸‹é¢éœ€è¦è¿æ¥åˆ°Vscodeã€‚é¦–å…ˆåœ¨Vscodeä¸­å®‰è£…WSLæ’ä»¶ï¼Œç„¶åç‚¹å‡»å³ä¸‹è§’çš„é‚£ä¸ªåŒç®­å¤´å°±å¯ä»¥è¿æ¥åˆ°WSLã€‚è¿æ¥å¥½åä½ å°±å¯ä»¥é€šè¿‡Vscodeçš„ç»ˆç«¯ç›´æ¥æ“ä½œLinuxç³»ç»Ÿï¼Œè€Œä¸”ä¹‹åä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡Vscodeæ‰“å¼€WSLï¼Œè€Œä¸å†éœ€è¦é€šè¿‡Windowsçš„å‘½ä»¤è¡Œæˆ–è€…ç»ˆç«¯ã€‚

ä¸ºäº†è·å¾—å®éªŒç¯å¢ƒè¿˜éœ€è¦ä¸‹è½½dockerï¼Œdockerçš„ä¸‹è½½å®‰è£…æ–¹æ³•ä¹Ÿè¯·STFWã€‚è¿™é‡Œä¹Ÿå¯èƒ½ä¼šé‡åˆ°å¾ˆå¤šé—®é¢˜ï¼Œè‡ªå·±æ‘¸ç´¢å§ï¼Œä¸é‡åˆ°é—®é¢˜æ€ä¹ˆçŸ¥é“è‡ªå·±åœ¨é…ç½®ç¯å¢ƒå‘¢ã€‚

å®‰è£…å¥½dockeråå°±éœ€è¦æ‹‰å–å®éªŒç¯å¢ƒçš„é•œåƒï¼š

```dockerfile
docker pull frankd35/demo:v3
```

å“¦ï¼Œå¯¹äº†ï¼Œç¬¬ä¸€æ­¥å…¶å®æ˜¯å¯åŠ¨dockerï¼š

```bash
sudo service docker start
```

æ‹‰å–é•œåƒçš„æ„æ€å…¶å®å’Œä¸‹è½½Windowsæˆ–è€…Linuxæ“ä½œç³»ç»Ÿçš„å®‰è£…åŒ…å·®ä¸å¤šï¼Œåªä¸è¿‡è¿™ä¸ªå®‰è£…åŒ…é‡Œé¢å·²ç»å¸®ä½ é…å¥½äº†é€‚é…äºæˆ‘ä»¬å®éªŒæ¡†æ¶çš„ç¯å¢ƒï¼Œé€šè¿‡æŒ‚è½½å°±å¯ä»¥ä½¿ç”¨ã€‚

ç„¶åå°±æ˜¯æŒ‚è½½ç›®å½•ï¼š

```dockerfile
docker run -it -v {ä½ çš„ä»£ç æ¡†æ¶ç›®å½•}:/coursegrader frankd35/demo:v3
```

æŒ‚è½½ç›®å½•å…¶å®ä¹Ÿæœ‰å‰ç½®æ­¥éª¤ï¼Œä½ é¦–å…ˆéœ€è¦æŠŠå·²ç»ä¸‹è½½å¥½çš„ä»£ç æ¡†æ¶å¤åˆ¶åˆ°Linuxç³»ç»Ÿä¸­ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯WSLï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡`cp`æŒ‡ä»¤å¤åˆ¶å‹ç¼©åŒ…ã€‚è‡³äºä¸ºä»€ä¹ˆå¯ä»¥ç›´æ¥é€šè¿‡`cp`æŒ‡ä»¤å¤åˆ¶ï¼Œè¿™æ˜¯å› ä¸ºWSLä¼šè‡ªåŠ¨å°†æˆ‘ä»¬çš„ç¡¬ç›˜æŒ‚è½½åˆ°`/mnt`ç›®å½•ä¸‹ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥è®¿é—®Windowsç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚ç„¶ååœ¨è‡ªå·±éœ€è¦çš„ç›®å½•ä¸‹è§£å‹ä»£ç æ¡†æ¶å°±å¯ä»¥äº†ï¼Œè§£å‹çš„ç›®å½•å°±å¯¹åº”ä¸Šé¢é‚£æ¡æŒ‡ä»¤é‡Œé¢çš„â€œä½ çš„ä»£ç æ¡†æ¶ç›®å½•â€ã€‚

å®Œæˆè¿™ä¸€æ­¥åå°±åˆ›å»ºäº†ä¸€ä¸ªdockerå®¹å™¨ï¼Œå¦‚æœä½ åœ¨Vscodeå®‰è£…äº†dockerçš„æ’ä»¶é‚£ä¹ˆåœ¨ä½ çš„å³è¾¹èœå•æ é‡Œé¢åº”è¯¥å¯ä»¥çœ‹åˆ°ä¸€ä¸ªé²¸é±¼æ ‡å¿—ï¼Œç‚¹å‡»æ ‡å¿—å¯ä»¥é€šè¿‡Vscodeæä¾›çš„å›¾å½¢åŒ–ç•Œé¢æ¥ä½¿ç”¨dockerã€‚å¦‚æœç‚¹å‡»åæ˜¾ç¤ºÃ—ï¼Œé‚£ä¹ˆè¯´æ˜ä½ çš„dockeræ²¡æœ‰å¯åŠ¨ã€‚

è¿›å…¥è¿‡ååº”è¯¥æœ‰ä¸‰æ ï¼Œç¬¬ä¸€æ æ˜¯CONTAINERSï¼Œä¹Ÿå°±æ˜¯å®¹å™¨ï¼Œå°±æ˜¯æˆ‘ä»¬å‰é¢æŒ‚è½½ç›®å½•æ‰€åˆ›å»ºçš„ä¸œè¥¿ã€‚ç¬¬äºŒæ æ˜¯IMAGESï¼Œä¹Ÿå°±æ˜¯é•œåƒï¼Œæ˜¯æˆ‘ä»¬æ‹‰å–çš„å®éªŒç¯å¢ƒã€‚ç¬¬ä¸‰æ æ²¡ç”¨åˆ°ï¼Œä¸ç”¨ç®¡ã€‚åˆšè¿›å…¥dockeråå¦‚æœå®¹å™¨æ˜¾ç¤ºçš„æ˜¯ä¸€ä¸ªæ©™çº¢è‰²çš„æ–¹æ¡†ï¼Œè¯´æ˜å®¹å™¨æ²¡æœ‰å¯åŠ¨ï¼Œå¯ä»¥å³é”®è¿™ä¸ªå®¹å™¨é€‰æ‹©Startï¼Œç„¶åè®°å¾—åˆ·æ–°ã€‚å¯åŠ¨åå®¹å™¨ä¼šå˜æˆç»¿è‰²çš„ç®­å¤´ï¼Œç„¶åå†æ¬¡å³é”®ï¼Œè¿™é‡Œå»ºè®®é€‰æ‹©é™„åŠ Vscodeï¼Œè¿™æ ·æ‰å¯ä»¥ç»§ç»­é…ç½®gdbå¹¶è¿æ¥åˆ°Vscodeã€‚ä¸€ä¸ªé•œåƒå¯ä»¥é€šè¿‡æŒ‚è½½ä¸åŒçš„ç›®å½•åˆ›å»ºå¤šä¸ªä¸åŒçš„å®¹å™¨ï¼Œè¿™æ ·å°±å¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªä»£ç ã€‚

> [!tip]
>
> ä»¥ä¸‹æ˜¯ç»™ç²¥ç²¥äººMuMuæ¨¡æ‹Ÿå™¨ç”¨æˆ·çš„ä¸€äº›å»ºè®®ã€‚åœ¨ä½ å¼€å¯WSLä¹‹åæœ‰æ²¡æœ‰å‘ç°æ¯æ¬¡è¿›å…¥æ¨¡æ‹Ÿå™¨å¼€å§‹åœ¨98%å¡ä½å¹¶ä¸”ç©èˆŸçš„æ—¶å€™ä¹Ÿå¼€å§‹å¡é¡¿äº†ï¼Ÿæˆ–è€…è¯´å¦‚æœä½ é€šè¿‡æ¨¡æ‹Ÿå™¨å…³é—­Hyper-VåWSLç”¨ä¸äº†äº†ï¼Ÿ
>
> ä¸ç”¨æ‹…å¿ƒï¼Œè¿™äº›éƒ½æ˜¯æ­£å¸¸ç°è±¡ï¼Œéƒ½æ˜¯Windowsä¸å¤ŸåŠªåŠ›å¯¼è‡´çš„ã€‚Windowsæä¾›çš„Hyper-Vä¼šå’Œæ¨¡æ‹Ÿå™¨çš„è™šæ‹Ÿæœºå†²çªï¼Œæ­£æ‰€è°“é±¼å’Œç†ŠæŒä¸å¯å…¼å¾—ï¼Œå¦‚æœä½ å¸Œæœ›æ¨¡æ‹Ÿå™¨ä¸å¡é¡¿ï¼Œé‚£å°±ç‚¹å‡»ä½ çš„æ¨¡æ‹Ÿå™¨çš„èœå•æ ï¼Œæ‰“å¼€é—®é¢˜è¯Šæ–­è¿›è¡Œä¼˜åŒ–ï¼Œæ¨¡æ‹Ÿå™¨ä¼šè‡ªåŠ¨ä¸ºä½ å…³é—­Hyper-Vã€‚å“ˆå“ˆï¼Œç„¶åä½ å°±ä¼šå‘ç°ä½ çš„WSLç”¨ä¸äº†äº†ã€‚
>
> ä¸è¿‡ä¹Ÿåˆ«æ€¥ï¼Œå¦‚æœä½ æƒ³è¦é‡æ–°æ‰“å¼€WSLä¹Ÿå¾ˆç®€å•ï¼Œç¬¬ä¸€æ­¥ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œç»ˆç«¯ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š`bcdedit /set hypervisorlaunchtype auto`ï¼›ç¬¬äºŒæ­¥å°±æ˜¯é€šè¿‡Windows->æœç´¢â€œå¯ç”¨æˆ–å…³é—­WindowsåŠŸèƒ½â€->å¼€å¯Hyper-Vã€‚å¦‚æœæ²¡æœ‰è¿™ä¸€é¡¹ï¼Œè¿˜éœ€è¦é€šè¿‡æ‰¹å¤„ç†åŠ å…¥è¿™ä¸€é¡¹ã€‚æ‰¹å¤„ç†çš„æŒ‡ä»¤å°±è‡ªå·±ä¸Šç½‘æœç´¢å§ã€‚
>
> ä½ é—®æˆ‘ä¸ºä»€ä¹ˆä¸€ä¸ªtipså†™çš„å’Œæ­£æ–‡å·®ä¸å¤šï¼Œé‚£å½“ç„¶æ˜¯å› ä¸ºç²¥ç²¥äººå¿ƒç–¼ç²¥ç²¥äººğŸ˜‹ã€‚



### 3.4 ç¼–è¯‘é¡¹ç›®

è¿›è¡Œåˆ°è¿™ä¸€æ­¥ç»ˆäºå¯ä»¥å¼€å§‹ç¼–è¯‘é¡¹ç›®äº†ï¼Œç¬¬ä¸€æ­¥æ˜¯ä¿®æ”¹CMakeLists.txtæ–‡ä»¶ä¸­çš„å‡ ä¸ªå°bugã€‚åœ¨æ–‡ä»¶ä¸­æ‰¾ä¸€ä¸ªä½ç½®æ·»åŠ ä»¥ä¸‹ä¸¤è¡Œä»£ç ï¼š

```cmake
set(CMAKE_C_COMPILER "/usr/bin/x86_64-linux-gnu-gcc-7")
set(CMAKE_CXX_COMPILER "/usr/bin/x86_64-linux-gnu-g++-7")
```

è¿™ä¸¤è¡Œä»£ç çš„ä½œç”¨æ˜¯æŒ‡å®šCå’ŒC++ç¼–è¯‘å™¨çš„è·¯å¾„å’Œç‰ˆæœ¬ã€‚

ç¬¬äºŒæ­¥æ˜¯åœ¨`/coursegrader`ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª`build`æ–‡ä»¶å¤¹ï¼Œç„¶åè¿›å…¥`build`æ–‡ä»¶å¤¹ï¼Œä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
cmake ..
make
```

è¿™æ ·å°±å¯ä»¥å®Œæˆé¡¹ç›®çš„ç¼–è¯‘ï¼Œç¼–è¯‘çš„ç»“æœæ˜¯åœ¨`/coursegrader/bin`ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªåä¸º`compiler`çš„å¯æ‰§è¡Œæ–‡ä»¶å’Œä¸€äº›å…¶å®ƒçš„ä¸­é—´æ–‡ä»¶ã€‚

#### 3.4.1 å•ç‚¹æµ‹è¯•

å•ç‚¹æµ‹è¯•éœ€è¦è¾“å…¥å¯¹åº”çš„å‚æ•°æ‰§è¡Œ`compiler`ç¨‹åºã€‚ç¨‹åºä¼šæ ¹æ®æˆ‘ä»¬è¾“å…¥å‚æ•°çš„ä¸åŒæ‰§è¡Œä¸åŒçš„åŠŸèƒ½ï¼Œå¯¹å‚æ•°çš„è§£æè¿‡ç¨‹åœ¨`main.cpp`æ–‡ä»¶ä¸­ï¼Œå¯ä»¥è‡ªå·±ç ”ç©¶ä¸€ä¸‹ã€‚è¿™é‡Œç»™å‡ºä¸€ä¸ªç¤ºä¾‹ï¼Œæ¯”å¦‚æˆ‘è¦æ‰§è¡Œ`00_main.sy`æµ‹è¯•ç‚¹çš„riscvæ±‡ç¼–ä»£ç ç”ŸæˆåŠŸèƒ½ï¼š

```bash
./bin/compiler ./test/testcase/basic/00_main.sy -S -o ./myTest/test.out
```

ç¬¬ä¸€ä¸ªå‚æ•°`./bin/compiler`æ˜¯ç¨‹åºçš„è·¯å¾„ï¼Œç¬¬äºŒä¸ª`./test/testcase/basic/00_main.sy`æ˜¯è¾“å…¥çš„æ–‡ä»¶è·¯å¾„ï¼Œç¬¬ä¸‰ä¸ª`-S`æ˜¯æ‰§è¡Œçš„é˜¶æ®µï¼Œç¬¬å››ä¸ª`-o`æ˜¯è¾“å‡ºæ–‡ä»¶é€‰é¡¹ï¼Œç¬¬äº”ä¸ª`./myTest/test.out`æ˜¯è¾“å‡ºæ–‡ä»¶çš„è·¯å¾„å’Œæ–‡ä»¶åã€‚

è¿™é‡Œå†æä¾›ä¸€ä¸ªæˆ‘çš„å¸¸ç”¨çš„å¿«é€ŸæŒ‡ä»¤å§ï¼Œå¯ä»¥å®Œæˆç¼–è¯‘->å•ç‚¹æµ‹è¯•çš„å…¨è¿‡ç¨‹ï¼š

```bash
cd /coursegrader
rm -rf build/
mkdir build
cd ./build
cmake ..
make
cd /coursegrader
./bin/compiler ./test/testcase/basic/00_main.sy S -o ./myTest/test.out
```

å…¶å®ä¹Ÿå¯ä»¥æŠŠè¿™äº›ä»£ç å†™æˆä¸€ä¸ªè„šæœ¬ï¼Œä¸è¿‡æˆ‘ä¸ä¼šï¼Œæœ‰å…´è¶£å¯ä»¥è‡ªå·±æ¢ç´¢ä¸€ä¸‹ã€‚



#### 3.4.2 é›†ä¸­æµ‹è¯•

é™¤äº†ä¸Šä¸€å°èŠ‚æä¾›çš„å•ç‚¹æµ‹è¯•çš„æ–¹æ³•ï¼Œæ¡†æ¶ä¸­è¿˜æä¾›äº†pythonè„šæœ¬æ¥è¿›è¡Œé›†ä¸­æµ‹è¯•ï¼Œæµ‹è¯•çš„è„šæœ¬åœ¨`test`ç›®å½•ä¸‹ã€‚å¯ä»¥ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥è¿›è¡Œæµ‹è¯•ï¼š

```bash
cd /coursegrader/test
python3 build.py
python3 run.py s0
python3 test.py s0
```

> [!note]
>
> pythonè„šæœ¬åœ¨è¾“å…¥åŠŸèƒ½å‚æ•°çš„æ—¶å€™å’Œå•ç‚¹æµ‹è¯•æœ‰ä¸€ç‚¹åŒºåˆ«ï¼Œå•ç‚¹æµ‹è¯•çš„æ—¶å€™éœ€è¦æ·»åŠ "-"ï¼Œè€ŒåŠŸèƒ½æµ‹è¯•ä¸éœ€è¦æ·»åŠ ï¼Œè¿™æ˜¯å› ä¸ºåœ¨è„šæœ¬ä¸­å†™äº†ä»£ç è‡ªåŠ¨æ·»åŠ "-"ã€‚
>
> ~~æˆ‘ä¸ç†è§£ï¼Œä¸ºä»€ä¹ˆä¸èƒ½è®¾è®¡æˆç»Ÿä¸€çš„æ–¹å¼ï¼Œéè¦åŠ äº›ä»£ç æ¥å®ç°è‡ªåŠ¨åŠ "-"ï¼Œè¿™ä¸æ˜¯åƒåŠ›ä¸è®¨å¥½å—ï¼Ÿ~~



### 3.5 é…ç½®è°ƒè¯•ç¯å¢ƒ

ä¸çŸ¥é“å¤§å®¶ä¹‹å‰æ˜¯æ€ä¹ˆdebugçš„ï¼Œæ˜¯ç”¨IDEæä¾›çš„debugåŠŸèƒ½è¿˜æ˜¯coutå¤§æ³•ã€‚å¦‚æœæ˜¯coutå¤§æ³•çš„è¯åªèƒ½åœ¨å•ç‚¹æµ‹è¯•ä½¿ç”¨ï¼Œç±»ä¼¼äºIDEçš„debugæ–¹æ³•éœ€è¦é…ç½®è°ƒè¯•ç¯å¢ƒã€‚

#### 3.5.1 coutå¤§æ³•

å¦‚æœä½ å¸Œæœ›ä½¿ç”¨coutå¤§æ³•ï¼Œå¯ä»¥é€‰æ‹©å¯¼å…¥å¤´æ–‡ä»¶`iostream`ï¼Œæˆ–è€…æŒ‰ç…§å®éªŒæŒ‡å¯¼ä¹¦ä¸­æä¾›çš„æ–¹æ³•ï¼Œæ‰“å¼€CMakeLists.txtæ–‡ä»¶ä¸­å…³äºè°ƒè¯•æ ‡å¿—çš„æ³¨é‡Šï¼Œç„¶ååœ¨ä»£ç ä¸­é€‚å½“çš„ä½ç½®æ·»åŠ å¤´æ–‡ä»¶å¹¶åŠ å…¥coutè¯­å¥ã€‚

> [!note]
>
> è¿™ç§æ–¹æ³•å…¶å®æ˜¯å¤§å‹é¡¹ç›®æ¯”è¾ƒå¸¸ç”¨çš„ä¸€ç§æ–¹æ³•ï¼Œé€šè¿‡å®å®šä¹‰åŒ…è£¹è°ƒè¯•ä¿¡æ¯è¾“å‡ºè¯­å¥ï¼Œå¯ä»¥åšåˆ°åœ¨éè°ƒè¯•æƒ…å†µä¸‹ä¸è¾“å‡ºè°ƒè¯•ä¿¡æ¯ï¼Œä¼˜åŒ–ç¨‹åºçš„æ€§èƒ½ã€‚ä¸‹é¢æ˜¯ä¸€äº›ä½¿ç”¨å®å®šä¹‰çš„ç¤ºä¾‹ï¼š
>
> ```c++
> #ifdef DEBUG_DFA
>     printf("Debug DFA: Some debug information\n");
> #endif
>
> #ifdef DEBUG_SCANNER
>     printf("Debug Scanner: Some debug information\n");
> #endif
>
> #ifdef DEBUG_PARSER
>     printf("Debug Parser: Some debug information\n");
> #endif
> ```



#### 3.5.2 gdbè°ƒè¯•

å¦‚æœä½ å¸Œæœ›èƒ½å¤Ÿä½¿ç”¨æ–­ç‚¹è°ƒè¯•æˆ–è€…ç›‘è§†ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­çš„å˜é‡ï¼Œé‚£ä¹ˆåªèƒ½é…ç½®gdbè°ƒè¯•ç¯å¢ƒã€‚gdbçš„ä½¿ç”¨æ–¹æ³•è¿˜è¯·RTFM+STFWã€‚ä¸è¿‡å¦‚æœæ˜¯åœ¨ç»ˆç«¯ä½¿ç”¨gdbæ„Ÿè§‰è¿˜æ˜¯ä¸å¤Ÿæ–¹ä¾¿ï¼Œæ‰€ä»¥è¿™é‡Œæä¾›ä¸€äº›æ–¹æ³•æŠŠgdbè¿æ¥åˆ°vscodeï¼Œè¿™æ ·ä½¿ç”¨gdbå°±å’Œåœ¨IDEä¸­ä½¿ç”¨debugåŠŸèƒ½å·®ä¸å¤šäº†ã€‚

é¦–å…ˆè¯·ç¡®ä¿ä½ çš„vscodeç›´æ¥è¿æ¥åˆ°äº†å®¹å™¨ï¼Œè€Œä¸æ˜¯wslã€‚æ£€æŸ¥çš„æ–¹æ³•å¾ˆç®€å•ï¼Œçœ‹vscodeå·¦ä¸‹è§’æœ‰æ²¡æœ‰å®¹å™¨ä¸¤ä¸ªå­—ã€‚ç„¶ååœ¨ä½ çš„é¡¹ç›®ç›®å½•ä¸‹æ·»åŠ ä¸€ä¸ªåä¸º`.vscode`çš„æ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«åä¸º`tasks.json`å’Œ`launch.json`ï¼Œå‰è€…æ˜¯ç”¨äºæŒ‡å¯¼é¡¹ç›®ç¼–è¯‘çš„ï¼Œåè€…æ˜¯ç”¨äºæŒ‡å¯¼debugå·¥å…·è¿æ¥çš„ã€‚

åœ¨`tasks.json`æ–‡ä»¶ä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š

```json
{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "build",
            "type": "shell",
            "command": "cd ${workspaceFolder} && rm -rf build/ && mkdir build && cd ./build && cmake .. && make && cd ${workspaceFolder}",
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "problemMatcher": [
                "$gcc"
            ],
            "detail": "ç¼–è¯‘ /coursegrader é¡¹ç›®"
        }
    ]
}
```

åœ¨`launch.json`æ–‡ä»¶å¤¹ä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š

```json
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Debug Compiler",
            "type": "cppdbg",
            "request": "launch",
            "program": "${workspaceFolder}/bin/compiler",
            "args": [
                // "./test/testcase/basic/00_main.sy",
                // "./test/testcase/basic/01_var_defn2.sy",
                // "./test/testcase/basic/02_var_defn3.sy",
                // "./test/testcase/basic/03_arr_defn2.sy",
                // "./test/testcase/basic/04_arr_defn3.sy",
                // "./test/testcase/basic/06_const_var_defn2.sy",
                // "./test/testcase/basic/07_const_var_defn3.sy",
                // "./test/testcase/basic/08_const_array_defn.sy",
                // "./test/testcase/basic/09_func_defn.sy",
                // "./test/testcase/basic/10_var_defn_func.sy",
                // "./test/testcase/basic/11_add2.sy",
                // "./test/testcase/basic/12_addc.sy",
                // "./test/testcase/basic/13_sub2.sy",
                // "./test/testcase/basic/14_subc.sy",
                // "./test/testcase/basic/15_mul.sy",
                // "./test/testcase/basic/16_mulc.sy",
                // "./test/testcase/basic/17_div.sy",
                // "./test/testcase/basic/18_divc.sy",
                // "./test/testcase/basic/20_rem.sy",
                // "./test/testcase/basic/21_if_test2.sy",
                // "./test/testcase/basic/22_if_test3.sy",
                // "./test/testcase/basic/23_if_test4.sy",
                // "./test/testcase/basic/25_while_if.sy",
                // "./test/testcase/basic/26_while_test1.sy",
                // "./test/testcase/basic/27_while_test2.sy",
                // "./test/testcase/basic/29_break.sy",
                // "./test/testcase/basic/30_continue.sy",
                // "./test/testcase/basic/31_while_if_test1.sy",
                // "./test/testcase/basic/32_while_if_test2.sy",
                // "./test/testcase/basic/33_while_if_test3.sy",
                // "./test/testcase/basic/35_op_priority1.sy",
                // "./test/testcase/basic/36_op_priority2.sy",
                // "./test/testcase/basic/37_op_priority3.sy",
                // "./test/testcase/basic/40_unary_op.sy",
                // "./test/testcase/basic/41_unary_op2.sy",
                // "./test/testcase/basic/42_empty_stmt.sy",
                // "./test/testcase/basic/45_comment1.sy",
                // "./test/testcase/function/28_while_test3.sy",
                // "./test/testcase/function/34_arr_expr_len.sy",
                // "./test/testcase/function/38_op_priority4.sy",
                // "./test/testcase/function/39_op_priority5.sy",
                // "./test/testcase/function/43_logi_assign.sy",
                // "./test/testcase/function/47_hex_oct_add.sy",
                // "./test/testcase/function/48_assign_complex_expr.sy",
                // "./test/testcase/function/49_if_complex_expr.sy",
                // "./test/testcase/function/50_short_circuit.sy",
                // "./test/testcase/function/51_short_circuit3.sy",
                // "./test/testcase/function/52_scope.sy",
                // "./test/testcase/function/55_sort_test1.sy",
                // "./test/testcase/function/62_percolation.sy",
                // "./test/testcase/function/64_calculator.sy",
                // "./test/testcase/function/66_exgcd.sy",
                // "./test/testcase/function/70_dijkstra.sy",
                // "./test/testcase/function/73_int_io.sy",
                // "./test/testcase/function/78_side_effect.sy",
                // "./test/testcase/function/79_var_name.sy",
                // "./test/testcase/function/89_many_globals.sy",
                "./test/testcase/function/95_float.sy",
                // "-e",
                // "-s2",
                // "-o",
                // "./myTest/test.ir",
                "-S",
                "-o",
                "./myTest/test.s"
            ],
            "stopAtEntry": false,
            "cwd": "${workspaceFolder}",
            "environment": [],
            "externalConsole": false,
            "MIMode": "gdb",
            "setupCommands": [
                {
                    "description": "Enable pretty-printing for gdb",
                    "text": "-enable-pretty-printing",
                    "ignoreFailures": true
                }
            ],
            "miDebuggerPath": "/usr/bin/gdb",
            "preLaunchTask": "build",
            "logging": {
                "engineLogging": true
            }
        }
    ]
}
```

> [!warning]
>
> è¿™é‡Œè¿˜éœ€è¦ä¿®æ”¹ä¸€ä¸‹CMakeLists.txtæ–‡ä»¶ä¸­çš„ä¸€ç‚¹bugï¼ŒåŸå§‹çš„é”™è¯¯è¯­å¥å¦‚ä¸‹ï¼š
>
> ```cmake
> set(CMAKE_CXX_FLAGS   "-g")                     # è°ƒè¯•ä¿¡æ¯
> set(CMAKE_CXX_FLAGS   "-Wall")                  # å¼€å¯æ‰€æœ‰è­¦å‘Š
> ```
>
> è¿™ç§å†™æ³•æ˜¯æœ‰é—®é¢˜çš„ï¼Œå¦‚æœä½ å¸Œæœ›åŒæ—¶å¼€å¯è°ƒè¯•ä¿¡æ¯å’Œè­¦å‘Šä¿¡æ¯ï¼Œéœ€è¦æŒ‰ç…§å¦‚ä¸‹å†™æ³•ï¼š
>
> ```cmake
> set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -g -Wall")  # è°ƒè¯•ä¿¡æ¯å’Œæ‰€æœ‰è­¦å‘Š
> ```
>
> å¦‚æœæŒ‰ç…§ç¬¬ä¸€ç§å†™æ³•æ˜¯ä¸ä¼šç”Ÿæˆè°ƒè¯•ä¿¡æ¯çš„ï¼Œä¹Ÿå°±ä¸èƒ½å¯ç”¨gdbè°ƒè¯•ã€‚

> [!note]
>
> æ‰€è°“çš„è°ƒè¯•ä¿¡æ¯å…¶å®å°±æ˜¯ç¬¦å·è¡¨å’Œä¸€äº›å…¶ä»–çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬ç°åœ¨ä¹Ÿæ˜¯åœ¨ç¼–å†™ä¸€ä¸ªç¼–è¯‘å™¨ï¼Œå¦‚æœä½ å†™å®Œäº†å®éªŒä¸‰ï¼Œé‚£ä¹ˆä½ ä¼šæ˜ç™½æˆ‘ä»¬çš„ç¬¦å·è¡¨çš„ä¿¡æ¯å…¶å®æ˜¯æ²¡æœ‰å‡ºç°åœ¨æ±‡ç¼–ä»£ç ä¸­çš„ã€‚å¼€å¯`-g`è¿™ä¸ªé€‰é¡¹ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨ç”Ÿæˆæ±‡ç¼–ä»£ç çš„æ—¶å€™ï¼ŒåŠ å…¥ä¸€äº›æ ‡è¯†ç¬¦ï¼Œå‘ŠçŸ¥gdbä¸€äº›å˜é‡çš„ä¿¡æ¯å’Œæ ˆä¿¡æ¯ã€‚ç„¶ååœ¨è¿è¡Œçš„æ—¶å€™å°±èƒ½åŒ¹é…è¿™äº›ä¿¡æ¯ï¼Œä»è€Œå¾—çŸ¥åŸå§‹çš„å˜é‡åå¹¶ä¸”å‘ˆç°å‡ºæ¥ã€‚

æœ€åä½¿ç”¨F5å¿«æ·é”®å°±å¯ä»¥å¼€å¯è°ƒè¯•äº†ï¼Œå…·ä½“çš„è°ƒè¯•æ–¹æ³•æˆ‘å°±ä¸ä»‹ç»äº†ï¼Œè‡ªå·±STFWå§ã€‚



## å››ã€å®éªŒæ¡†æ¶ç›®å½•è¯´æ˜

```

```



##  äº”ã€å®éªŒä¸€

å®éªŒä¸€åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼Œè¯æ³•åˆ†æå’Œè¯­æ³•åˆ†æã€‚

### 5.1 è¯æ³•åˆ†æ

è¯æ³•åˆ†æçš„è¾“å…¥æ˜¯æºç¨‹åºï¼Œè¾“å‡ºæ˜¯tokenä¸²ã€‚ä¸»è¦çš„å·¥ä½œå¯ä»¥åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€æ˜¯é¢„å¤„ç†å™¨ï¼Œç”¨äºåˆ é™¤æ³¨é‡Šï¼›äºŒæ˜¯DFAæœ‰é™çŠ¶æ€æœºï¼Œé€šè¿‡çŠ¶æ€è½¬æ¢æ¥è¾“å‡ºå¯¹åº”çš„tokenä¸²ã€‚

é¢„å¤„ç†å™¨çš„å·¥ä½œåŸç†ä¸»è¦æ˜¯é€šè¿‡é€è¡Œè¯»å–æ–‡ä»¶è¾“å…¥æµæ¥åˆ é™¤æ³¨é‡Šã€‚éœ€è¦å¤„ç†çš„æ³¨é‡Šåˆ†ä¸ºä¸¤ç§ç±»å‹ã€‚

- ç¬¬ä¸€ç§æ˜¯å•è¡Œæ³¨é‡Šï¼Œæ¯”è¾ƒç®€å•ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š`// ...`ï¼Œå¦‚æœåœ¨ä¸€è¡Œä¸­æŸ¥æ‰¾åˆ°ä¸¤ä¸ªè¿ç»­çš„`//`ï¼Œé‚£ä¹ˆå°±å¯ä»¥è®¤ä¸ºæ˜¯å•è¡Œæ³¨é‡Šçš„èµ·ç‚¹ï¼Œè¿å¸¦è¿™ä¸¤ä¸ªå­—ç¬¦åŠæœ¬è¡Œåé¢çš„å†…å®¹éƒ½åˆ é™¤å³å¯ï¼›
- ç¬¬äºŒç§æ˜¯å¤šè¡Œæ³¨é‡Šï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªå¸ƒå°”å‹çš„å˜é‡`isInMulCom`æ¥è¾…åŠ©è¿›è¡Œå¤„ç†ï¼Œè¿™ä¸ªå˜é‡ä¸»è¦ç”¨äºè®°å½•å½“å‰æ˜¯å¦å­˜åœ¨äºå¤šè¡Œæ³¨é‡Šå†…éƒ¨ï¼Œå¤šè¡Œæ³¨é‡Šçš„æ ¼å¼å¦‚ä¸‹`/* ... */`ï¼Œéœ€è¦é€šè¿‡æŸ¥æ‰¾`/*`æ¥ç¡®å®šå¤šè¡Œæ³¨é‡Šçš„èµ·ç‚¹ã€‚å¦‚æœæœ¬è¡Œæœ‰å¤šè¡Œæ³¨é‡Šèµ·ç‚¹ï¼Œé‚£ä¹ˆå°±å…ˆåœ¨æœ¬è¡ŒæŸ¥æ‰¾`*/`ï¼Œå¦‚æœå­˜åœ¨ï¼Œè¿å¸¦å¤šè¡Œæ³¨é‡Šèµ·å§‹ç¬¦å†…çš„æ‰€æœ‰å†…å®¹éƒ½éœ€è¦åˆ é™¤ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±å°†å˜é‡ç½®1ï¼Œæ ‡è®°å½“å‰å¤„äºå¤šè¡Œæ³¨é‡Šå†…éƒ¨ï¼Œç„¶ååˆ é™¤æœ¬è¡Œå¤šè¡Œæ³¨é‡Šèµ·ç‚¹åçš„æ‰€æœ‰å†…å®¹ï¼Œå¹¶ç»§ç»­å¤„ç†ä¸‹ä¸€è¡Œï¼Œå¤„ç†ä¸‹ä¸€è¡Œæ—¶ç›´æ¥æŸ¥æ‰¾å¤šè¡Œæ³¨é‡Šç»“æŸç¬¦ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ é™¤è¿™ä¸€è¡Œï¼Œå¦åˆ™åˆ é™¤è¿™ä¸€è¡Œå¼€å§‹ç›´è‡³ç»“æŸç¬¦çš„æ‰€æœ‰å†…å®¹ã€‚

DFAçŠ¶æ€æœºçš„ä»»åŠ¡å°±æ˜¯å¯¹é¢„å¤„ç†è¿‡åçš„æºç¨‹åºè¿›è¡Œåˆ†è¯ã€‚DFAä¼šé€ä¸ªè¯»å…¥å¤„ç†åçš„æºç¨‹åºï¼Œç„¶åæ ¹æ®äº‹å…ˆç»™å®šçš„è½¬ç§»å‡½æ•°è½¬ç§»åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼ŒæŸäº›è½¬ç§»å‡½æ•°ä¼šè¿›è¡Œè¾“å‡ºã€‚æœ¬æ¬¡å®éªŒè®¾è®¡çš„çŠ¶æ€è½¬ç§»å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![çŠ¶æ€è½¬ç§»å›¾](./RAEDME.assets/image-20240616162137445.png)

åœ¨DFAå®ç°è¿‡ç¨‹ä¸­æœ‰å‡ ä¸ªç‚¹éœ€è¦æ³¨æ„ï¼š

- DFAçŠ¶æ€æœºè®¾ç½®äº†è¾“å‡ºç¼“å†²åŒºï¼Œå› ä¸ºä¸æ˜¯æ¯ä¸€æ¬¡éƒ½éœ€è¦è¾“å‡ºï¼Œåªæœ‰å½“`next()`å‡½æ•°è¿”å›ä¸ºçœŸæ—¶æ‰è¾“å‡ºç¼“å†²åŒºå¹¶æ¸…ç©ºã€‚
- æœ‰ä¸€ç§æµ®ç‚¹æ•°æ¯”è¾ƒç‰¹åˆ«ï¼Œç›´æ¥ä»¥å°æ•°ç‚¹å¼€å§‹ï¼Œé»˜è®¤å¤„ç†ä¸º`0.`ï¼Œéœ€è¦æ³¨æ„ã€‚
- æ•´å‹å­—é¢é‡æœ‰æ¯”è¾ƒç‰¹åˆ«çš„è¾“å…¥ï¼Œå½¢å¦‚`0xb`ï¼Œæ‰€ä»¥å¦‚æœåœ¨`IntLiteral`çŠ¶æ€ä¸‹è¯»å…¥å­—æ¯çš„è¯ï¼Œä»ç„¶éœ€è¦ä½œä¸ºæ•´å‹å­—é¢é‡çš„ä¸€éƒ¨åˆ†å­˜å…¥ç¼“å†²åŒºï¼Œå¹¶ä¸”ä¸è·³è½¬çŠ¶æ€ã€‚
- è¿™é‡Œçš„æ“ä½œç¬¦ç›¸å¯¹äºä½œä¸šé‡Œé¢çš„æƒ…å†µæ›´åŠ å¤æ‚ï¼Œå‡ºç°äº†ä¸¤å­—ç¬¦å®½çš„æ“ä½œç¬¦ï¼Œæ‰€ä»¥éœ€è¦æ–°å»ºä¸€ä¸ª`isDoubleWidthOperator`å‡½æ•°æ¥åˆ¤æ–­ä¸¤å­—ç¬¦å®½çš„æ“ä½œç¬¦åˆä¸åˆæ³•ã€‚ä¹‹æ‰€ä»¥éœ€è¦åˆ¤æ–­ï¼Œæ˜¯å› ä¸ºå½¢å¦‚`+-`è¿™æ ·çš„å•å­—ç¬¦å®½çš„æ“ä½œç¬¦ä¹Ÿæ˜¯åˆæ³•çš„ï¼Œä½†æ˜¯å®ƒä¸æ˜¯ä¸¤å­—ç¬¦å®½çš„æ“ä½œç¬¦ï¼Œæ‰€ä»¥éœ€è¦å¤„ç†ä¸ºä¸¤ä¸ªå•å­—ç¬¦å®½æ“ä½œç¬¦ã€‚



### 5.2 è¯­æ³•åˆ†æ

è¯­æ³•åˆ†æçš„è¾“å…¥æ˜¯è¯æ³•åˆ†æè¾“å‡ºçš„`token`ä¸²ï¼Œè¾“å‡ºåˆ™æ˜¯ä¸€æ£µæŠ½è±¡è¯­æ³•æ ‘ã€‚æŠ½è±¡è¯­æ³•æ ‘(abstract syntax tree, AST)æ˜¯æºä»£ç è¯­æ³•ç»“æ„çš„ä¸€ç§æŠ½è±¡è¡¨ç¤ºã€‚å®ƒä»¥æ ‘çŠ¶çš„å½¢å¼è¡¨ç°ç¼–ç¨‹è¯­è¨€çš„è¯­æ³•ç»“æ„ï¼Œæ ‘ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½è¡¨ç¤ºæºä»£ç ä¸­çš„ä¸€ç§ç»“æ„ã€‚ä»£ç æ¡†æ¶ä¸­æä¾›äº†å…³äºæŠ½è±¡è¯­æ³•æ ‘æ¯ä¸ªèŠ‚ç‚¹çš„å®šä¹‰ã€‚

> [!warning]
>
> å®éªŒä¸€å’Œå®éªŒäºŒæ¡†æ¶æä¾›çš„æŠ½è±¡è¯­æ³•æ ‘çš„èŠ‚ç‚¹ä¿¡æ¯æ˜¯ä¸å®Œæ•´ï¼Œæ‰€ä»¥æ¨èç›´æ¥ä½¿ç”¨å®éªŒä¸‰çš„ä»£ç æ¡†æ¶ã€‚

æœ¬å®éªŒé‡‡ç”¨é€’å½’ä¸‹é™æ³•è¿›è¡Œè¯­æ³•åˆ†æï¼Œæ–‡æ³•è§„åˆ™å‚è€ƒ`SysYè¯­è¨€å®šä¹‰-V1.pdf`ä¸­çš„å†…å®¹ï¼Œæœ€ç»ˆæŒ‰ç…§å®éªŒæŒ‡å¯¼ä¹¦ä¸­çš„æ–‡æ³•è§„åˆ™å®ç°ï¼Œä¸€å…±æœ‰31æ¡æ–‡æ³•è§„åˆ™ã€‚

> [!note]
>
> å®éªŒæŒ‡å¯¼ä¹¦ä¸­çš„æ–‡æ³•è§„åˆ™ç›¸è¾ƒäºåŸç‰ˆï¼Œæ¶ˆé™¤äº†å·¦é€’å½’ï¼Œå¹¶ä¸”é€šè¿‡ä¼˜åŒ–å¤„ç†äº†è¿ç®—é¡ºåºçš„é—®é¢˜ã€‚

å…·ä½“å®ç°çš„æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼Œå°±æ˜¯æŒ‰ç…§å®éªŒæŒ‡å¯¼ä¹¦ä¸­æä¾›çš„æ€è·¯è¿›è¡Œï¼š

1. åˆ¤æ–­å½“å‰indexæ‰€æŒ‡çš„tokenæ˜¯å¦ä¸ºäº§ç”Ÿå¼æ‰€è¦æ±‚çš„`token`ç±»å‹ï¼Œå¦‚æœä¸æ˜¯åˆ™å‘ç”Ÿäº†é”™è¯¯ï¼Œé€šè¿‡`assert`è¯­å¥ä¸­æ–­ã€‚å…·ä½“æ˜¯å®ç°äº†ä¸€ç»„`matchNode`å‡½æ•°ï¼Œå‡½æ•°è¿”å›è¿™ä¸€èŠ‚ç‚¹ä¸‹æ‰€æœ‰å¯èƒ½çš„`token`ç»„åˆã€‚è¿™é‡Œç»™å‡ºä¸€ä¸ª`CompUnit`çš„ä¾‹å­ï¼š

   ```c++
   std::unordered_set<frontend::TokenType> Parser::matchCompUnit()
   { // CompUnit -> (Decl | FuncDef) [CompUnit]
       return {frontend::TokenType::CONSTTK, frontend::TokenType::INTTK,
               frontend::TokenType::FLOATTK, frontend::TokenType::VOIDTK};
   }
   ```

2. å‡½æ•°çš„ä¸»ä½“åŠŸèƒ½å°±æ˜¯å¦‚æœåŒ¹é…ä¸Šè¿™æ ·çš„èŠ‚ç‚¹ï¼Œå°±å¼€å§‹æ‰§è¡Œé€’å½’ã€‚`new`ä¸€ä¸ª`Term`èŠ‚ç‚¹å¹¶å°†`token`å†…å®¹æ‹·è´åˆ°èŠ‚ç‚¹ä¸­ï¼Œå°†è¯¥èŠ‚ç‚¹åŠ å…¥`parent`çš„å­èŠ‚ç‚¹ï¼Œ`Parser`çš„`index++`ã€‚

3. è¿™é‡Œè¿˜å®ç°äº†ä¸€ä¸ª`undo`å‡½æ•°æ¥è¿›è¡Œå›æº¯ï¼š

   ```c++
   void Parser::undo(int _lastIndex, AstNode *_res, int _curChildrenNums)
   {
       index = _lastIndex;
       while (_res->children.size() > _curChildrenNums)
           _res->children.pop_back();
       return;
   }
   ```

   éœ€è¦è¿›è¡Œå›æº¯çš„åŸå› å°±æ˜¯å·²ç»é…ä¸Šäº†éƒ¨åˆ†`token`ï¼Œä½†æ˜¯å‘ç°ä¹‹åçš„åŒ¹é…å¤±è´¥äº†ï¼Œè¯´æ˜å…¶å®ä¸æ˜¯è¿™ç§æƒ…å†µï¼Œéœ€è¦å›æº¯åˆ°æœ€åˆçš„çŠ¶æ€è·³è¿‡è¿™ç§æƒ…å†µç»§ç»­åŒ¹é…ä¸‹ä¸€ç§æƒ…å†µã€‚æ‰€ä»¥`undo`çš„åŠŸèƒ½å°±æ˜¯æ¢å¤å¼€å§‹æ—¶`token`çš„ä¸‹æ ‡ï¼Œç„¶åæŠŠé”™è¯¯åŠ å…¥çš„å­èŠ‚ç‚¹å¼¹å‡ºã€‚

4. éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œæœ‰ä¸€æ¡æ–‡æ³•è§„åˆ™æ¯”è¾ƒç‰¹åˆ«ï¼Œå•é å›æº¯æ— æ³•å¤„ç†ï¼š`ä¸€å…ƒè¡¨è¾¾å¼ UnaryExp -> PrimaryExp | Ident '(' [FuncRParams] ')' | UnaryOp UnaryExp`ã€‚æ¯”å¦‚æµ‹è¯•ç‚¹9ä¸­çš„`b=func(a);`ï¼Œæ‰§è¡Œåˆ°è¿™ä¸€æ­¥çš„æ—¶å€™ï¼Œéœ€è¦åŒ¹é…`func`å­—æ®µã€‚å¦‚æœæŒ‰ç…§æ­£å¸¸é¡ºåºåŒ¹é…ï¼Œæ˜¯ä¼šå…ˆä¸`PrimaryExp`åŒ¹é…ï¼Œæ­¤æ—¶ä¼šæŒ‰ç…§ä¸‹åˆ—é¡ºåºåŒ¹é…ï¼š`PrimaryExp -> '(' Exp ')' | LVal | Number`ï¼Œ`LVal -> Ident { '[' Exp ']' }`ï¼Œè¿™æ—¶`func`åŒ¹é…`Ident`ï¼Œä½†æ˜¯è¿™ä¸ªåŒ¹é…ä¸æ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼Œè€Œä¸”ç”±äºå·²ç»é€’å½’åˆ°ä¸‹ä¸€å±‚ï¼Œæ‰€ä»¥ä¸èƒ½å•é å›æº¯è¿›è¡Œæ¢å¤äº†ã€‚æœ‰ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„åŠæ³•è§„é¿è¿™ä¸ªé—®é¢˜ï¼šä¿®æ”¹åŒ¹é…çš„é¡ºåºï¼Œå…ˆè¿›è¡Œ`Ident '(' [FuncRParams] ')'`åŒ¹é…ï¼Œè¿™æ ·å°±å¯ä»¥è§£å†³è¿™æ¡æ–‡æ³•è§„åˆ™çš„ç¼ºé™·ã€‚



## å…­ã€å®éªŒäºŒ

å®éªŒäºŒçš„ç›®æ ‡æ˜¯è¾“å…¥å®éªŒä¸€çš„ç»“æœæŠ½è±¡è¯­æ³•æ ‘ï¼Œç»è¿‡è¯­ä¹‰åˆ†æå’Œè¯­æ³•åˆ¶å¯¼ç¿»è¯‘ï¼Œç”Ÿæˆä¸­é—´è¡¨ç¤ºIRã€‚å®éªŒäºŒæ„Ÿè§‰æ˜¯æœ¬æ¬¡å®éªŒè¿‡ç¨‹ä¸­æœ€éš¾çš„ä¸€ä¸ªéƒ¨åˆ†ï¼Œä»è¿™éƒ¨åˆ†å¼€å§‹æ²¡æœ‰æ ‡å‡†çš„ç»“æœï¼Œåªè¦èƒ½å¤Ÿè¾¾æˆç›®çš„ï¼Œåœ¨è¯„æµ‹æœºä¸­æˆåŠŸè¿è¡Œè·å¾—æ­£ç¡®çš„ç»“æœå³å¯ã€‚ä½†æ˜¯è¿™ä¹Ÿæ˜¯æœ€éº»çƒ¦çš„ä¸€ç‚¹ï¼Œè¿™æ„å‘³ç€ä½ éœ€è¦äº†è§£è¯„æµ‹æœºçš„è¿è¡Œé€»è¾‘ï¼Œè¯„æµ‹æœºçš„ä»£ç åœ¨å®éªŒæ¡†æ¶ä¸­å·²ç»ç»™å‡ºï¼Œå¤§å®¶å¯ä»¥è‡ªå·±ç ”ç©¶ï¼Œå…¶å®è¯„æµ‹æœºçš„å®ç°é€»è¾‘ä¸Šä¹Ÿæœ‰ä¸€äº›åç›´è§‰çš„åœ°æ–¹ï¼Œæ‰€ä»¥ç”ŸæˆIRçš„è¿‡ç¨‹å¤§æ¦‚ç‡æ˜¯ä¼šé‡åˆ°é—®é¢˜éœ€è¦å»æŸ¥çœ‹è¯„æµ‹æœºã€‚IRçš„è¯­æ³•å®šä¹‰è¯·å‚è€ƒå®éªŒæŒ‡å¯¼ä¹¦ï¼Œä¸‹é¢æ¥å¤§è‡´è¯´æ˜ä¸€ä¸‹æˆ‘å®Œæˆå®éªŒäºŒçš„è¿‡ç¨‹ã€‚

> [!note]
>
> è¯„æµ‹æœºæœ‰ä¸¤ç§ä½¿ç”¨æ–¹æ³•ï¼Œä¸€ç§æ˜¯é€šè¿‡é™æ€é“¾æ¥åº“é“¾æ¥ï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡æºä»£ç ç¼–è¯‘å®ç°ã€‚
>
> è¿™é‡Œæ¨èå¤§å®¶å…¨ç¨‹ä½¿ç”¨é™æ€é“¾æ¥çš„æ–¹æ³•ï¼Œæºä»£ç åªæ˜¯ä½œä¸ºå‚è€ƒï¼Œä½ å¯ä»¥åŠ æ³¨é‡Šï¼Œä½†æ˜¯ä¸è¦ä¿®æ”¹ï¼Œå› ä¸ºä¿®æ”¹ä¹Ÿæ²¡æœ‰ï¼Œåˆ°äº†çº¿ä¸Šè¯„æµ‹çš„æ—¶å€™è¿˜æ˜¯è¿è¡Œçš„é™æ€é“¾æ¥åº“é‡Œé¢çš„è¯„æµ‹æœºã€‚
>
> ä½¿ç”¨é™æ€é“¾æ¥åº“çš„æ–¹æ³•å¦‚ä¸‹ï¼š
>
> 1. ä¿®æ”¹CMakeLists.txtæ–‡ä»¶ä¸­çš„è¯­å¥å¦‚ä¸‹ï¼š
>
>    ```cmake
>    # --------------------- from lib ---------------------
>    # link libxx.a
>    # u should rename libxx-x86-win.a or libxx-x86-linux.a to libxx.a according to ur own platform
>    link_directories(./lib)
>    # --------------------- from lib ---------------------
>
>    # ä¸ºäº† debug æ–¹ä¾¿ï¼Œä½ å¯ä»¥é€‰æ‹©é€šè¿‡æºæ–‡ä»¶æ¥æ„å»º IR æµ‹è¯„æœºï¼Œä½†æ˜¯è¯·ä»¥é“¾æ¥é™æ€åº“æ–‡ä»¶çš„æ–¹å¼å»è·‘åˆ†ï¼ˆä¸ºäº†é˜²æ­¢ä½ ä»¬ä¿®æ”¹æµ‹è¯„æœºï¼Œåœ¨OJä¸Šæˆ‘ä»¬ä¼šé‡‡å–æ­¤æ–¹å¼ï¼‰
>    # --------------------- from src ---------------------
>    aux_source_directory(./src/ir IR_SRC)
>    add_library(IR ${IR_SRC})
>    aux_source_directory(./src/tools TOOLS_SRC)
>    add_library(Tools ${TOOLS_SRC})
>    # --------------------- from src ---------------------
>    ```
>
>    è¿™é‡Œæ³¨é‡Šæ‰äº†æºç çš„è·¯å¾„ï¼Œæ‰“å¼€äº†é“¾æ¥åº“çš„è·¯å¾„ã€‚
>
> 2. é‡å‘½åé“¾æ¥åº“æ–‡ä»¶ã€‚ä½ éœ€è¦æ ¹æ®è‡ªå·±çš„ç³»ç»Ÿæ¶æ„é‡å‘½åé™æ€è¿æ¥åº“æ–‡ä»¶ï¼Œæ‰¾åˆ°è‡ªå·±çš„é“¾æ¥åº“ç›®å½•ï¼Œä¸‹é¢æœ‰4ä¸ª`.a`æ–‡ä»¶ï¼Œå¦‚æœä½ æ˜¯Linuxç³»ç»Ÿï¼Œå°±æŠŠ`libxx-x86-win.a`é‡å‘½åä¸º`libxx.a`ã€‚
>
> ä½¿ç”¨æºä»£ç çš„æ–¹æ³•å¦‚ä¸‹ï¼š
>
> ä¿®æ”¹CMakeLists.txtæ–‡ä»¶ä¸­çš„è¯­å¥å¦‚ä¸‹ï¼š
>
> ```cmake
> # --------------------- from lib ---------------------
> # link libxx.a
> # u should rename libxx-x86-win.a or libxx-x86-linux.a to libxx.a according to ur own platform
> # link_directories(./lib)
> # --------------------- from lib ---------------------
>
> ä¸ºäº† debug æ–¹ä¾¿ï¼Œä½ å¯ä»¥é€‰æ‹©é€šè¿‡æºæ–‡ä»¶æ¥æ„å»º IR æµ‹è¯„æœºï¼Œä½†æ˜¯è¯·ä»¥é“¾æ¥é™æ€åº“æ–‡ä»¶çš„æ–¹å¼å»è·‘åˆ†ï¼ˆä¸ºäº†é˜²æ­¢ä½ ä»¬ä¿®æ”¹æµ‹è¯„æœºï¼Œåœ¨OJä¸Šæˆ‘ä»¬ä¼šé‡‡å–æ­¤æ–¹å¼ï¼‰
> --------------------- from src ---------------------
> aux_source_directory(./src/ir IR_SRC)
> add_library(IR ${IR_SRC})
> aux_source_directory(./src/tools TOOLS_SRC)
> add_library(Tools ${TOOLS_SRC})
> --------------------- from src ---------------------
> ```
>
> è¿™é‡Œæ³¨é‡Šæ‰äº†é“¾æ¥åº“çš„è·¯å¾„ï¼Œæ‰“å¼€äº†æºä»£ç çš„è·¯å¾„ã€‚

æˆ‘åœ¨å®éªŒäºŒé‡‡å–äº†é¸µé¸Ÿç­–ç•¥ï¼Œç®€å•æ¥è¯´å°±æ˜¯æµ‹è¯•ç‚¹éœ€è¦ä»€ä¹ˆæˆ‘å†™ä»€ä¹ˆï¼Œåªè¦æµ‹è¯•ç‚¹æ²¡æœ‰æˆ‘å°±ä¸å†™ã€‚è¿™æ ·çš„ä¸€ä¸ªå¥½å¤„å°±æ˜¯å¯ä»¥é¿å…å¾ˆå¤šä¸å¿…è¦ï¼ˆä¸æ˜¯çœŸçš„ä¸å¿…è¦ï¼Œæ˜¯æœ¬æ¬¡å®éªŒä¸éœ€è¦ï¼‰çš„åˆ†ç±»è®¨è®ºï¼Œå½“ç„¶ä¹Ÿæœ‰åå¤„ï¼Œå¦‚æœä½ ä¸åœ¨é€‚å½“çš„åœ°æ–¹ç”¨`assert`ä¸­æ–­ï¼Œé‚£ä¹ˆåé¢å‡ºç°äº†ä¸ä¸€è‡´çš„æƒ…å†µçš„æ—¶å€™å¯èƒ½æ‰¾éƒ½æ‰¾ä¸åˆ°ï¼Œæ‰€ä»¥ä¸€å®šè¦ç”¨å¥½`if...else`å’Œ`assert`ã€‚

ä¸‡äº‹å¼€å¤´éš¾ï¼Œå®éªŒäºŒå¼€å¤´å°¤å…¶éš¾ã€‚ä¸ºäº†è®©æµ‹è¯•ç‚¹1èƒ½å¤Ÿè·‘èµ·æ¥ï¼ŒçœŸçš„æ˜¯éå¸¸éš¾ã€‚ä¸è¿‡ä¸€æ—¦æµ‹è¯•ç‚¹1é€šè¿‡ï¼Œé‚£ä¹ˆè¯´æ˜ä½ å¯¹æ•´ä¸ªå®éªŒäºŒçš„æ¡†æ¶å·²ç»ç†è§£å¾—å·®ä¸å¤šäº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯ä½“åŠ›æ´»äº†ã€‚

ä¸ºäº†è®©æµ‹è¯•ç‚¹1è·‘èµ·æ¥ï¼Œè¦å®Œæˆä»¥ä¸‹å‡ ä»¶äº‹ï¼š

1. åˆ›å»ºä¸€ä¸ª`ir::Program`ç”¨äºå­˜æ”¾IRç¨‹åºã€‚
2. æŒ‰ç…§æµ‹è¯•ç‚¹1çš„ASTæ·±åº¦ä¼˜å…ˆéå†çš„é¡ºåºï¼Œä¾æ¬¡ç¼–å†™`analyzeNode`å‡½æ•°æ¥è¿›è¡Œè¯­ä¹‰åˆ†æã€‚è¿™é‡Œå°±è¯´æ˜ä¸€ä¸‹æ¯ä¸€ä¸ª`analyzeNode`éœ€è¦åšçš„äº‹ï¼Œå…¶å®é€»è¾‘å’Œè¯­æ³•åˆ†ææœ‰ç‚¹ç±»ä¼¼ï¼Œå°±æ˜¯å…ˆåŒ¹é…èŠ‚ç‚¹ç±»å‹ï¼ŒåŒ¹é…ä¸Šäº†å°±è°ƒç”¨åŒ¹é…èŠ‚ç‚¹çš„`analyzeNode`è¿›è¡Œå¤„ç†ã€‚å¤„ç†è¿‡ç¨‹ä¸­éœ€è¦è¡¥å……èŠ‚ç‚¹çš„å±æ€§ï¼Œè¿™äº›å±æ€§éƒ½åœ¨èŠ‚ç‚¹å®šä¹‰çš„ä»£ç é‡Œï¼ŒåŒæ—¶ä¹Ÿéœ€è¦åœ¨åˆé€‚çš„æ—¶å€™åœ¨`program`ä¸­æ·»åŠ IRã€‚
3. æœ€åè¿”å›`program`å°±å¯ä»¥äº†ã€‚

ä¹‹åçš„äº‹å°±æ˜¯ä¸€ä¸ªæµ‹è¯•ç‚¹ä¸€ä¸ªæµ‹è¯•ç‚¹åœ°è¿è¡Œï¼Œå®Œå–„æ¯ä¸€ä¸ªæµ‹è¯•ç‚¹éœ€è¦çš„`analyzeNode`ã€‚ä¸‹é¢æ¥è¯´æ˜ä¸€ä¸‹å®éªŒäºŒçš„ä¸€äº›æ³¨æ„ç‚¹ï¼š

- ä½œç”¨åŸŸçš„æ·»åŠ ã€‚å…¶å®åœ¨`get_ir_program`å‡½æ•°ä¸­åˆ†æ`CompUnit`ä¹‹å‰å°±åº”å½“è°ƒç”¨ä¸€æ¬¡`add_scope`ï¼Œè¿™æ˜¯å› ä¸ºéœ€è¦æœ‰ä¸€ä¸ªæœ€å¤§çš„ä½œç”¨åŸŸæ¥åŒ…è£¹å…¨å±€å˜é‡ã€‚åœ¨å®šä¹‰æ¯ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™ä¹Ÿéœ€è¦ä»å‡½æ•°å½¢å‚å¼€å§‹è¿›å…¥ä½œç”¨åŸŸï¼Œåœ¨å‡½æ•°å¤„ç†å®Œåé€€å‡ºã€‚è¿˜æœ‰å°±æ˜¯åœ¨`Stmt`èŠ‚ç‚¹å¤„ç†`Block`èŠ‚ç‚¹æ—¶ä¹Ÿéœ€è¦è¿›å…¥æ–°ä½œç”¨åŸŸï¼Œå¤„ç†å®Œæˆåé€€å‡ºã€‚å…¶å®ç†è§£èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œæ¯ä¸€å¯¹æ–°çš„`{}`åŒ…è£¹çš„ä»£ç æ®µéƒ½æ˜¯ä¸€ä¸ªæ–°çš„ä½œç”¨åŸŸã€‚

- ç¬¦å·è¡¨çš„ç»´æŠ¤ã€‚ä¸åŒçš„ä½œç”¨åŸŸä¸­çš„å˜é‡æ˜¯å…è®¸é‡åçš„ï¼Œä¸ºäº†åœ¨å®ç°ç¼–è¯‘å™¨çš„æ—¶å€™æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä¼šæ ¹æ®è¿™ä¸ªå˜é‡æ‰€åœ¨çš„ä½œç”¨åŸŸä¸ºå®ƒé‡æ–°ç”Ÿæˆä¸€ä¸ªå¸¦æœ‰ä½œç”¨åŸŸåç¼€çš„æ–°åç§°ï¼Œç„¶åæ’å…¥ç¬¦å·è¡¨ä¸­ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ•°ç»„æ¯”è¾ƒç‰¹åˆ«ï¼Œå®ƒæ¯”å˜é‡è¿˜éœ€è¦å¤šç»´æŠ¤ä¸€ä¸ªç»´åº¦å±æ€§ï¼Œä»¥çŸ¥é“æ•°ç»„æ¯ä¸ªç»´åº¦çš„ä¿¡æ¯ï¼Œä¸ºäº†ä¾¿äºå¤„ç†æ•°ç»„ï¼Œæˆ‘è¿˜æ·»åŠ ç»™ç¬¦å·è¡¨é¡¹æ·»åŠ äº†ä¸€ä¸ª`size`å±æ€§ï¼Œè¡¨ç¤ºè¿™ä¸ªæ•°ç»„çš„å¤§å°ï¼Œé¿å…é€šè¿‡ç»´åº¦åå¤è®¡ç®—ã€‚è¿™é‡Œè¿˜æœ‰éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œæˆ‘çš„æ™®é€šå˜é‡çš„`size`è®¾ç½®ä¸º0ï¼Œæ•°ç»„çš„å¤§å°ä¸º1~âˆã€‚è¿™æ˜¯ä¸ºäº†åŒºåˆ«æ™®é€šå˜é‡å’Œå¤§å°ä¸º1çš„æ•°ç»„ã€‚

  > :warning:æ³¨æ„
  >
  > å¯¹äºæ•°ç»„çš„ç»´åº¦ï¼Œå®éªŒæŒ‡å¯¼ä¹¦ä¸­æœ‰è¿™æ ·ä¸€å¥è¯ï¼š
  >
  > ![image-20240616193622411](./RAEDME.assets/image-20240616193622411.png)
  >
  > ä¹Ÿå°±æ˜¯è¯´åªéœ€è¦å®ç°äºŒç»´æ•°ç»„çš„è§£æå°±å¯ä»¥äº†ï¼Œä½†æ˜¯æˆ‘åšå®éªŒçš„æ—¶å€™æ²¡æœ‰çœ‹åˆ°ã€‚

- è¿è¡Œæ—¶åº“çš„å¤„ç†ã€‚åœ¨`get_ir_program`å‡½æ•°ä¸­åˆ†æ`CompUnit`ä¹‹å‰å°±éœ€è¦æ·»åŠ è¿è¡Œæ—¶åº“ï¼Œä¸ç„¶é‡åˆ°å¯¹äºè¿è¡Œæ—¶åº“ä¸­å‡½æ•°çš„è°ƒç”¨æ— æ³•å¤„ç†ã€‚ç„¶ååœ¨å¤„ç†å®Œ`CompUnit`ä¹‹ååº”å½“åˆ é™¤è¿è¡Œæ—¶åº“çš„ç›¸å…³å‡½æ•°ï¼Œä¸ç„¶åœ¨å®éªŒä¸‰ä¸­ä¼šå‡ºé”™ã€‚

  > :warning:æ³¨æ„
  >
  > ä½ ä¼šå‘ç°å®éªŒæŒ‡å¯¼ä¹¦è¯´æä¾›äº†`sylib.c`çš„å‚è€ƒå®ç°ï¼Œä½†æ˜¯ä½ åœ¨ä»£ç æ¡†æ¶é‡Œé¢æ˜åœ°ä¸‰å°ºä¹Ÿåªèƒ½æ‰¾åˆ°ä¸€ä¸ª`sylib.h`ï¼Œæ ¹æœ¬æ‰¾ä¸åˆ°å®ç°ã€‚åˆ«æ€¥ï¼Œæˆ‘æ‰¾åˆ°äº†ï¼Œåœ¨æˆ‘çš„ä»£ç çš„`/coursegrader/src/tools`è·¯å¾„ä¸‹ä½ å¯ä»¥çœ‹åˆ°ï¼Œæˆ–è€…ä½ ä¹Ÿå¯ä»¥å»çœ‹çœ‹å®˜æ–¹æä¾›çš„[sylib.c](https://gitlab.eduxiji.net/csc1/nscscc/compiler2022/-/blob/master/å…¬å¼€æ ·ä¾‹ä¸è¿è¡Œæ—¶åº“/sylib.c)ã€‚

- å…¨å±€å˜é‡çš„å¤„ç†ã€‚åœ¨`get_ir_program`å‡½æ•°ä¸­åˆ†æ`CompUnit`ä¹‹åè¿˜éœ€è¦æ‰‹åŠ¨å®Œæˆå¯¹`globalVal`çš„æ·»åŠ ï¼Œä½œç”¨åŸŸ0ä¸­çš„å˜é‡å³ä¸ºå…¨å±€å˜é‡ã€‚ç„¶åè¿˜éœ€è¦æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªåä¸º`global`çš„å‡½æ•°æ¥å®Œæˆå¯¹å…¨å±€å˜é‡çš„åˆå§‹åŒ–ã€‚

> [!important]
>
> å†™åœ¨å®éªŒäºŒçš„æœ€åï¼š
>
> å…³äºå®éªŒäºŒæˆ‘å°±æƒ³èµ·æ¥è¿™ä¹ˆå¤šï¼Œåˆ«çš„è¿˜æ˜¯RTFSCå§ã€‚æœ€åè¿˜æœ‰ä¸€å¥å¿ å‘Šï¼Œå½“ä½ åœ¨çœ‹æˆ‘çš„ä»£ç è§‰å¾—æˆ‘ç½—é‡Œå§å—¦ä¸€å †å†—ä½™çš„æ—¶å€™ï¼Œå…ˆä¸è¦å–·ï¼Œæˆ‘çŸ¥é“æˆ‘çš„ä»£ç æ˜¯ä¸€å¨å±å±±ï¼Œä½†æ˜¯åœ¨ä½ å®Œæˆå®éªŒä¸‰è¿‡åä½ æ‰èƒ½ç†è§£è¿™å¨å±å±±çš„å«é‡‘é‡ï¼Œå®ƒæ˜¯ç›¸å½“å¾—ç²¾è‡´ï¼Œå—ä¸å¾—ä¸€ç‚¹å§”å±ˆã€‚





### ä¿®æ”¹è¿‡æºä»£ç ï¼Œéœ€è¦é‡æ–°ç¼–è¯‘æ‰§è¡Œ

```bash
cd /coursegrader
rm -rf build/
mkdir build
cd ./build
cmake ..
make
cd /coursegrader
./bin/compiler ./test/testcase/basic/00_main.sy -S -o ./myTest/test.out
```



### ä½¿ç”¨pythonè„šæœ¬æµ‹è¯•ï¼ˆè¯æ³•åˆ†ææµ‹è¯•ï¼‰

```bash
cd /coursegrader/test
python3 build.py
python3 run.py s0
python3 test.py s0
```



### ä½¿ç”¨pythonè„šæœ¬æµ‹è¯•ï¼ˆè¯­æ³•åˆ†ææµ‹è¯•ï¼‰

```bash
cd /coursegrader/test
python3 build.py
python3 run.py s1
python3 test.py s1
```



### ä½¿ç”¨pythonè„šæœ¬æµ‹è¯•ï¼ˆè¯­ä¹‰åˆ†ææµ‹è¯•ï¼‰

```bash
cd /coursegrader/test
python3 build.py
python3 run.py s2
python3 test.py s2
```



### ä½¿ç”¨pythonè„šæœ¬æµ‹è¯•ï¼ˆç›®æ ‡ä»£ç ç”Ÿæˆæµ‹è¯•ï¼‰

```bash
cd /coursegrader/test
python3 build.py
python3 run.py S
python3 test.py S
```



### å•ä¸ªæµ‹è¯•ç‚¹æµ‹è¯•

```bash
cd /coursegrader
rm -rf build/
mkdir build
cd ./build
cmake ..
make
cd /coursegrader
./bin/compiler ./test/testcase/function/70_dijkstra.sy -S -o ./myTest/test.s
cd /coursegrader/myTest
riscv32-unknown-linux-gnu-gcc test.s sylib-riscv-linux.a -o test.out
qemu-riscv32.sh test.out
```



```bash
cd /coursegrader/myTest
riscv32-unknown-linux-gnu-gcc -S testref.c -o testref.s
riscv32-unknown-linux-gnu-gcc testref.s sylib-riscv-linux.a -o testref.out
qemu-riscv32.sh testref.out
cd /coursegrader/test

```

```
10
0x1.999999999999ap-4 0x1.999999999999ap-3 0x1.3333333333333p-2 0x1.999999999999ap-2 0x1.0000000000000p-1
0x1.3333333333333p-1 0x1.6666666666666p-1 0x1.999999999999ap-1 0x1.ccccccccccccdp-1 0x1.0000000000000p+0
0x1.199999999999ap+0
0x1.199999999999ap+1
0x1.a666666666666p+1
0x1.199999999999ap+2
0x1.6000000000000p+2
0x1.a666666666666p+2
0x1.ecccccccccccdp+2
0x1.199999999999ap+3
0x1.3cccccccccccdp+3
0x1.4333333333333p+3

cd /coursegrader/myTest
riscv32-unknown-linux-gnu-gcc test.s sylib-riscv-linux.a -o test.out
qemu-riscv32.sh test.out
```
